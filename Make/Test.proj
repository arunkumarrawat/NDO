<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="12.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<!-- You need to adjust these values, otherwise the build will not work -->
	<PropertyGroup Label="Adjustable properties">
		<NDO_DIR>..</NDO_DIR>
		<Version>5.0.0</Version>
		<!-- 
			NDO generates packages which should be present in the package source
			during the build process.
			The PackageSourceFolder folder should be defined as 
			package source in Visual Studio.
		-->
		<PackageSourceFolder>$(NDO_DIR)\BuiltPackages</PackageSourceFolder>
	</PropertyGroup>
	
  <PropertyGroup>
	<Configuration Condition="'$(Configuration)'==''">Release</Configuration>
	<Platform>AnyCPU</Platform>
	<PackagesDir>$(userprofile)\.nuget\packages</PackagesDir>
  
	<MAKE_DIR>$(NDO_DIR)\Make</MAKE_DIR>
	<TOOLS_DIR>$(NDO_DIR)\Tools</TOOLS_DIR>
	<MAP_DIR>$(NDO_DIR)\SimpleMappingTool</MAP_DIR>
	<GEN_DIR>$(NDO_DIR)\ClassGenerator</GEN_DIR>
  </PropertyGroup>

	<ItemGroup>
		<Tools Include="$(TOOLS_DIR)\MakeEnhancerDate\MakeEnhancerDate.csproj" />	
		<Tools Include="$(TOOLS_DIR)\PatchNdoVersion\PatchNdoVersion.csproj" />	
	</ItemGroup>
	
	<ItemGroup>
		<PackProject Include="ndointerfaces"></PackProject>
		<PackProject Include="ndo.dll"></PackProject>
		<PackProject Include="ndo.core"></PackProject>
		<PackProject Include="ndo.mapping"></PackProject>
		<PackProject Include="ndo.jsonformatter"></PackProject>
		<PackProject Include="ndo.providerfactory"></PackProject>
		<PackProject Include="ndo.schemagenerator"></PackProject>
	</ItemGroup>
	
	<ItemGroup>
		<ProjectsToPatch Include="$(NDO_DIR)\NDOInterfaces\NDOInterfaces.csproj" ></ProjectsToPatch>
		<ProjectsToPatch Include="$(NDO_DIR)\NDODLL\NDO.csproj" ></ProjectsToPatch>
	</ItemGroup>
	
	<Target Name="DeletePackages" BeforeTargets="CreatePackageDir">
		<RemoveDir Condition="Exists('$(PackagesDir)\%(PackProject.Identity)\$(Version)')" Directories="$(PackagesDir)\%(PackProject.Identity)\$(Version)" />
	</Target>
	
	<Target Name="PatchNdoVersion" AfterTargets="DeletePackages">
		<Exec Command="$(TOOLS_DIR)\PatchNdoVersion\bin\Release\net8.0\PatchNdoVersion"
	</Target>
	
	<Target Name="CreatePackageDir" BeforeTargets="Build">
		<MakeDir Condition="!Exists('$(PackageSourceFolder)')" Directories="$(PackageSourceFolder)" />
	</Target>
	<Target Name="RestoreMsg" BeforeTargets="Restore">
		<Message Text="$(Lala)"></Message>
	</Target>

	<Target Name="Build">
		<Message Text="Build..."></Message>
	  	<MSBuild Projects="@(Tools)" BuildInParallel="True" Targets="Rebuild" Properties="Configuration=Release;Platform=AnyCPU" />
	</Target>
  
</Project>